% include("header")

<body class="w-full h-screen">
    %include("left-panel")
    <div class="w-3/4 min-h-screen border-x border-gray-300 absolute top-0 sm:left-96 md:left-1/4 left-1/3 z-20
    ">
      <section id="profile-page" class="border-r border-slate-200 w-[90%] p-6">
        <div class="w-full h-64 bg-gray-400">
          <div> <img id="main-img" class="absolute top-48 p-4 flex-none h-52 w-52 rounded-full"
              src="/img/{{user['image']}}" alt="photo"></div>
        </div>
        <form class="relative flex" onsubmit="return false">
          <label>
            <input id="profile-img" type="file" name="image" class=" hidden">
            <i class="fa fa-camera text-4xl ml-36 mt-16 text-gray-400"></i>
          </label>
          <div class="ml-auto mt-10 px-4">
            <button id="{{user['name']}}" onclick="uploadProfilePic(id)"
              class=" text-lg text-gray-600 font-medium bg-gray-300 hover:bg-gray-400 hover:text-white rounded-full w-32 p-1">Set
              profile pic</button>
          </div>
        </form>

        <div id="user-info" class="mt-4 px-4 py-2">
          <p id ='{{user["name"]}}' class = "text-xl text-gray-500">@{{user["name"]}}</p>
          <p class = "text-xl">{{user["full_name"]}}</p>
          <div class="flex"> <i class="fas fa-calendar mt-1 text-xl"></i>
            <p class="pl-4 pt-1 text-xl">Joined:
              <span class="text-gray-500">{{user["joined"]}} </span> </p>
          </div>

        </div>
        <div id="links" class="flex justify-between font-bold p-2 border-b-2 border-gray-200">
          <p class="cursor-pointer border-b-4 hover:border-blue-500 px-2 text-xl">Tweets</p>
          <p class="cursor-pointer hover:border-b-4 border-blue-500 px-2 text-xl">Tweets&replies</p>
          <p class="cursor-pointer hover:border-b-4 border-blue-500 px-2 text-xl">Media</p>
          <p class="cursor-pointer hover:border-b-4 border-blue-500 px-2 text-xl">Likes</p>

        </div>
        <p class="font-extrabold text-2xl ml-2">Tweets</p>
        %for tweet in tweets:
        <!-- tweets -->

        <section id="{{tweet['tweet_id']}}" class="p-4 border-t border-slate-200">
          <div class="flex">
            <img id="profile-photo" class="flex-none w-12 h-12 rounded-full" src="/img/{{user['image']}}" alt="photo">
            <div class="w-full pl-4">
              <div class="flex cursor-pointer">
                <p class="ml-auto text-sm text-gray-500">{{tweet["tweet_created_at"]}}</p>
              </div>
              </a>
              <div id="tweet-text" class="pt-2">
                {{tweet["tweet_text"]}}
              </div>
              %if tweet['tweet_image'] !="":
              <img id="tweet-img" class="mt-2 w-full object-cover h-80" src="/img/{{tweet['tweet_image']}}">
              % end

              <div id="icons" class="flex gap-12 w-full mt-4 text-lg">
                <button id="delete" onclick="deleteTweet(`{{tweet['tweet_id']}}`)"><i
                    class="fa-solid fa-trash mr-auto cursor-pointer"></i> </button>

                <button onclick="showTweetToEdit(`{{tweet['tweet_id']}}`)">
                  <i class="fa-solid fa-pen mr-auto cursor-pointer"></i>
                </button>
                <!-- TODO: like event and trigger -->
                <button><i class="fa-solid fa-heart cursor-pointer  ml-auto"></i></button>

              </div>
            </div>
          </div>
        </section>
        %end

      </section>
    </div>


    <script>
      // TODO: move to script in SPA upload profile img
      function uploadProfilePic(id) {

        console.log("click", id)

      }
      //update tweet
      async function uploadProfilePic(id) {
        const form = event.target.form
        console.log("form")
        //Connect to the api
        const connection = await fetch(`/${id}`, {
          method: "PUT",
          body: new FormData(form)
        })
        console.log(connection)
        if (!connection.ok) {
          alert("Wrong image format, only .jpg, .jpeg, and png allowed")
          return
        }
        //Success
        let updatedImg = await connection.json()
        document.querySelector("#profile-photo").src = "/img/" + updatedImg.user_image + ""
        document.querySelector("#main-img").src = "/img/" + updatedImg.user_image + ""
      }

      function ui(){
      let user = document.querySelector("#user-info p").id
      document.querySelector("#login-btn").classList.add("hidden")
      document.querySelector("#logout-btn").classList.add("hidden")
      }
      ui()
    </script>
</body>